
# --- FUNGSI PENGGANTI BUILT-IN ---

def simple_rand(seed):
    """
    Fungsi pengacakan sederhana (Pseudorandom Number Generator)
    menggantikan import random.
    """
    # Linear Congruential Generator (LCG)
    a = 1664525
    c = 1013904223
    m = 2**32 
    
    seed = (seed % m + m) % m
    seed = (a * seed + c) % m
    
    return seed, seed / m

def simple_shuffle_and_choice(data, count, seed):
    """
    Mengacak list 'data' dan mengambil 'count' elemen, menggantikan random.shuffle
    dan random.sample.
    """
    n = len(data)
    if count > n:
        count = n
        
    temp_list = list(data)
    current_seed = seed
    
    # Algoritma Fisher-Yates shuffle yang dimodifikasi
    for i in range(n - 1, 0, -1):
        current_seed, rand_val = simple_rand(current_seed)
        j = int(rand_val * (i + 1))
        temp_list[i], temp_list[j] = temp_list[j], temp_list[i]
        
    return current_seed, temp_list[:count]

def clear_screen_simple():
    """Menggantikan import os.system('clear') dengan mencetak banyak baris kosong."""
    print('\n' * 50) 

# --- KONSTANTA WARNA (ANSI Escape Codes) ---
COLOR_HEADER = "\033[96m" 
COLOR_HIGHLIGHT = "\033[93m" 
COLOR_SUCCESS = "\033[92m" 
COLOR_ERROR = "\033[91m"    
COLOR_RESET = "\033[0m"

# --- DATA HEWAN ---
DAFTAR_HEWAN = {
    "kucing": "KUCING",
    "anjing": "ANJING",
    "gajah": "GAJAH",
    "harimau": "HARIMAU",
    "singa": "SINGA",
    "ular": "ULAR",
    "jerapah": "JERAPAH",
    "kambing": "KAMBING",
    "beruang": "BERUANG",
    "buaya": "BUAYA",
    "cicak":"CICAK",
    "kuda": "KUDA",
    "ikan": "IKAN",
    "ayam": "AYAM",
    'bebek': "BEBEK",
    "kambing": "KAMBING",
    "kuda nil": "KUDA NIL",
    "domba": "DOMBA",
    "kucing": "KUCING",
}

# --- LOGIKA GAME ---

def tampilkan_header():
    """Menampilkan judul dan header game."""
    print("=" * 60)
    print(f"        {COLOR_HEADER}â­ GAME TEBAK NAMA HEWAN{COLOR_RESET}")
    print(f"        {COLOR_HIGHLIGHT}Sistem Skor Adaptif{COLOR_RESET}")
    print("=" * 60)

def tampilkan_aturan():
    """Menampilkan peraturan dan cara bermain."""
    tampilkan_header()
    print(f"\n{COLOR_HEADER}ğŸ“œ PERATURAN & CARA BERMAIN{COLOR_RESET}")
    print("-" * 30)
    print("1. Pilih level untuk menentukan jumlah soal dan poin dasar.")
    print(f"2. Ketik '{COLOR_HIGHLIGHT}HINT{COLOR_RESET}' untuk petunjuk (Maks. 2x per soal).")
    print("3. Poin berkurang saat menggunakan Hint, tetapi ada bonus jika salah beruntun.")
    print(f"4. Ketik '{COLOR_HIGHLIGHT}QUIT{COLOR_RESET}' untuk keluar dari permainan.")
    print("-" * 60)
    input(f"Tekan {COLOR_SUCCESS}ENTER{COLOR_RESET} untuk melanjutkan...")
    clear_screen_simple()

def pilih_level():
    """
    Meminta pengguna memilih level kesulitan dan menentukan variabel game: 
    rasio, nama level, jumlah soal, dan poin dasar.
    """
    while True:
        tampilkan_header()
        print(f"\n{COLOR_HIGHLIGHT}PILIH LEVEL KESULITAN:{COLOR_RESET}")
        print(f"1. Mudah (5 Soal, Poin Maks. 20/Jwb)")
        print(f"2. Sedang (10 Soal, Poin Maks. 10/Jwb)")
        print(f"3. Sulit (10 Soal, Poin Maks. 10/Jwb)")
        
        pilihan = input("\nMasukkan angka level (1/2/3): ").strip()
        clear_screen_simple()
        
        if pilihan == '1':
            # Rasio: 25%, Level: Mudah, Jumlah Soal: 5, Poin Dasar: 20
            return 0.25, "MUDAH", 5, 20
        elif pilihan == '2':
            # Rasio: 50%, Level: Sedang, Jumlah Soal: 10, Poin Dasar: 10
            return 0.50, "SEDANG", 10, 10
        elif pilihan == '3':
            # Rasio: 75%, Level: Sulit, Jumlah Soal: 10, Poin Dasar: 10
            return 0.75, "SULIT", 10, 10
        else:
            tampilkan_header()
            print(f"{COLOR_ERROR}Pilihan tidak valid. Silakan masukkan 1, 2, atau 3.{COLOR_RESET}")
            input("Tekan ENTER untuk coba lagi...")
            clear_screen_simple()

def generate_soal(nama_hewan, rasio_sembunyi, seed):
    """Membuat format soal berdasarkan rasio_sembunyi."""
    panjang = len(nama_hewan)
    jumlah_sembunyi = int(panjang * rasio_sembunyi)
    jumlah_sembunyi = max(1, min(panjang - 1, jumlah_sembunyi))

    indeks_semua = list(range(panjang))
    new_seed, indeks_sembunyi = simple_shuffle_and_choice(indeks_semua, jumlah_sembunyi, seed)

    soal_list = list(nama_hewan.upper())
    for i in indeks_sembunyi:
        soal_list[i] = '_'

    return new_seed, "".join(soal_list)

def berikan_hint(jawaban_kunci, tebakan_saat_ini, seed):
    """Membuka satu huruf 'underscore' secara acak menggunakan PRNG."""
    tebakan_list = list(tebakan_saat_ini)
    
    indeks_kosong = [i for i, char in enumerate(tebakan_list) if char == '_']
    
    if not indeks_kosong:
        return seed, tebakan_saat_ini

    new_seed, rand_val = simple_rand(seed)
    indeks_pilih = int(rand_val * len(indeks_kosong))
    
    indeks_buka = indeks_kosong[indeks_pilih]
    
    tebakan_list[indeks_buka] = jawaban_kunci[indeks_buka].upper()
    
    return new_seed, "".join(tebakan_list)

def hitung_skor_dan_feedback(benar, hints_used, consecutive_wrong_count, poin_dasar):
    """
    Menghitung skor berdasarkan aturan.
    """
    skor_didapat = 0
    pesan = ""
    reset_consecutive = False
    bonus_beruntun = 0

    # Penalti Hint (Konstan)
    if hints_used == 1:
        pengurang_hint = 5
    elif hints_used >= 2:
        pengurang_hint = 8
    else:
        pengurang_hint = 0

    if benar:
        reset_consecutive = True
        
        # Poin Benar: Poin Dasar dikurangi Penalti (minimal 1)
        skor_didapat = max(1, poin_dasar - pengurang_hint) 
        
        if hints_used == 0:
            pesan = f"{COLOR_SUCCESS}âœ… BENAR!{COLOR_RESET} Poin Dasar: {COLOR_SUCCESS}+{skor_didapat}{COLOR_RESET}"
        elif hints_used == 1:
            pesan = f"{COLOR_SUCCESS}âœ… BENAR!{COLOR_RESET} Poin (-1 Hint): {COLOR_SUCCESS}+{skor_didapat}{COLOR_RESET}"
        elif hints_used >= 2:
            pesan = f"{COLOR_SUCCESS}âœ… BENAR!{COLOR_RESET} Poin (-2 Hint): {COLOR_SUCCESS}+{skor_didapat}{COLOR_RESET}"
    else:
        # Jawaban Salah
        reset_consecutive = False
        
        # Cek Bonus Salah Beruntun
        if consecutive_wrong_count >= 1:
            bonus_beruntun = 8
            pesan += f"{COLOR_HIGHLIGHT}â­ BONUS INSENTIF BERUNTUN! {COLOR_SUCCESS}+8 Poin{COLOR_RESET}. "
        
        # Poin Kompensasi Salah
        if hints_used == 0 or hints_used == 1:
            skor_didapat = 3
            pesan += f"{COLOR_ERROR}âŒ SALAH.{COLOR_RESET} Poin Kompensasi: {COLOR_SUCCESS}+3{COLOR_RESET}"
        elif hints_used >= 2:
            skor_didapat = 1
            pesan += f"{COLOR_ERROR}âŒ SALAH.{COLOR_RESET} Poin Kompensasi: {COLOR_SUCCESS}+1{COLOR_RESET}"
            
        skor_didapat += bonus_beruntun

    return skor_didapat, pesan, reset_consecutive


def main_game():
    """Fungsi utama untuk menjalankan logika permainan."""
    
    # Inisialisasi Seed (Pure Python Hash)
    SEED_INITIAL = hash("start_game_pure_python") % 2**32
    current_seed = SEED_INITIAL
    
    tampilkan_header()
    tampilkan_aturan()
    
    # Ambil variabel level: rasio, nama, jumlah soal, dan poin dasar
    rasio, level_nama, jumlah_soal, poin_dasar = pilih_level()
    
    kunci_hewan = list(DAFTAR_HEWAN.keys())
    # Pilih jumlah soal sesuai level
    current_seed, soal_game = simple_shuffle_and_choice(kunci_hewan, jumlah_soal, current_seed)

    skor = 0
    keluar_game = False
    consecutive_wrong_count = 0 

    # Perulangan Soal
    for i, jawaban_kunci in enumerate(soal_game):
        if keluar_game:
            break
            
        nama_asli = DAFTAR_HEWAN[jawaban_kunci]
        current_seed, tebakan_saat_ini = generate_soal(nama_asli, rasio, current_seed)
        hints_used = 0 
        
        while True:
            clear_screen_simple()
            tampilkan_header()
            print(f"--- {COLOR_HIGHLIGHT}SOAL {i + 1} DARI {jumlah_soal}{COLOR_RESET} | Level: {level_nama} ---")
            print(f"POIN DASAR: {poin_dasar} | SKOR SAAT INI: {COLOR_SUCCESS}{skor}{COLOR_RESET}")
            print(f"Salah Beruntun Sebelumnya: {consecutive_wrong_count}")
            print("\nTEBAK NAMA HEWAN INI:")
            print(f"   {COLOR_HEADER}>>>>> {tebakan_saat_ini} <<<<<{COLOR_RESET}")
            
            # Tampilkan status hint/quit
            status_hint = f"Hint digunakan: {hints_used}/2 | Ketik '{COLOR_HIGHLIGHT}HINT{COLOR_RESET}'" if hints_used < 2 else "Hint Maksimum (2/2) tercapai"
            print(f"\n[{status_hint} | '{COLOR_HIGHLIGHT}QUIT{COLOR_RESET}' untuk keluar]")
                
            print("=" * 60)

            # Input Jawaban
            jawaban_user = input("Jawaban Anda: ").strip().lower()

            if jawaban_user == "quit":
                print(f"\n{COLOR_HIGHLIGHT}Anda memilih keluar. Permainan dihentikan.{COLOR_RESET}")
                keluar_game = True
                break
                
            elif jawaban_user == "hint":
                if hints_used < 2:
                    current_seed, tebakan_saat_ini = berikan_hint(jawaban_kunci, tebakan_saat_ini, current_seed)
                    hints_used += 1
                    print(f"\n{COLOR_SUCCESS}Hint berhasil digunakan! ({hints_used}/2){COLOR_RESET}")
                    input("Tekan ENTER untuk melanjutkan...") 
                    continue 
                else:
                    print(f"\n{COLOR_ERROR}Hint sudah digunakan 2 kali! Silakan jawab.{COLOR_RESET}")
                    input("Tekan ENTER untuk melanjutkan...")
                    continue

            # Cek Jawaban dan Terapkan Skor Baru
            benar = (jawaban_user == jawaban_kunci)
            
            # Hitung skor, menggunakan poin_dasar dari level
            skor_didapat, pesan_feedback, reset_consecutive = hitung_skor_dan_feedback(
                benar, hints_used, consecutive_wrong_count, poin_dasar
            )
            
            # Perbarui skor total
            skor += skor_didapat
            
            print(f"\n{pesan_feedback}")
            print(f"Jawaban yang benar: {COLOR_SUCCESS}{nama_asli}{COLOR_RESET}")
            print(f"Skor Total Saat Ini: {COLOR_SUCCESS}{skor}{COLOR_RESET}")
            
            # Perbarui pelacak jawaban salah beruntun
            if reset_consecutive:
                consecutive_wrong_count = 0
            else:
                consecutive_wrong_count += 1
            
            input("Tekan ENTER untuk soal berikutnya...")
            break 

    # --- AKHIR GAME ---
    clear_screen_simple()
    tampilkan_header()
    
    if keluar_game:
        print(f"\n{COLOR_HIGHLIGHT}PERMAINAN DIBATALKAN.{COLOR_RESET}")
    else:
        print(f"\n\n{COLOR_HIGHLIGHT}ğŸ‰ GAME SELESAI! ğŸ‰{COLOR_RESET}")
        print(f"Anda bermain di level: {COLOR_HIGHLIGHT}{level_nama}{COLOR_RESET} ({jumlah_soal} soal)")
    
    print("-" * 35)
    print(f"Total Skor Akhir Anda: {COLOR_SUCCESS}{skor}{COLOR_RESET}")
    print("-" * 35)
    print("Terima kasih sudah bermain! Sampai jumpa lagi.\n")

# Jalankan game
if __name__ == "__main__":                                                              
    # Handle KeyboardInterrupt secara manual karena kita tidak menggunakan import sys/time
    try:
        main_game()
    except KeyboardInterrupt:
        clear_screen_simple()
        print(f"\n\n{COLOR_HIGHLIGHT}Game dihentikan oleh pengguna (Ctrl+C). Sampai jumpa!{COLOR_RESET}")
